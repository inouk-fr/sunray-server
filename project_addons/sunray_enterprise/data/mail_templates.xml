<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- Email Template: Setup Token -->
        <record id="mail_template_setup_token_v2" model="mail.template">
            <field name="name">Sunray: Setup Token</field>
            <field name="model_id" ref="sunray_core.model_sunray_setup_token"/>
            <field name="subject">Your Sunray Setup Token for {{ object.host_id.domain }}</field>
            <field name="email_from">{{ object.env.company.email_formatted or 'Sunray-Zero-Trust &lt;noreply@sunray-zero-trust.com&gt;' }}</field>
            <field name="email_to">{{ object.user_id.email }}</field>
            <field name="auto_delete" eval="False"/>
            <field name="body_html" type="html">
<div style="margin: 0px; padding: 0px; font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 13px;">
    <div style="background-color: #f9f9f9; padding: 20px 0px;">
        <table cellpadding="0" cellspacing="0" style="margin: 0 auto; width: 600px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <!-- Header -->
            <tr>
                <td style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; border-radius: 8px 8px 0 0;">
                    <h1 style="color: white; margin: 0; font-size: 24px; font-weight: normal;">
                        üîê Your Sunray Setup Token
                    </h1>
                </td>
            </tr>

            <!-- Body -->
            <tr>
                <td style="padding: 30px;">
                    <p style="margin: 0 0 20px; font-size: 14px; line-height: 1.6;">
                        Hello <strong><t t-out="object.user_id.username or ''">User</t></strong>,
                    </p>

                    <p style="margin: 0 0 20px; font-size: 14px; line-height: 1.6;">
                        A setup token has been generated for you to configure passkey authentication for <strong><t t-out="object.host_id.domain or ''">host.example.com</t></strong>.
                    </p>

                    <!-- Token Box -->
                    <div style="background: #f8f9fa; border: 2px dashed #6c757d; border-radius: 6px; padding: 20px; margin: 20px 0; text-align: center;">
                        <div style="color: #6c757d; font-size: 11px; text-transform: uppercase; margin-bottom: 8px;">
                            Setup Token
                        </div>
                        <div id="tokenValue" style="font-family: 'Courier New', monospace; font-size: 20px; font-weight: bold; letter-spacing: 2px; color: #212529; word-break: break-all; margin-bottom: 15px; user-select: all; cursor: text;">
                            <t t-out="ctx.get('token_value', '')">TOKEN-VALUE</t>
                        </div>
                        <button onclick="navigator.clipboard.writeText(document.getElementById('tokenValue').innerText); this.innerText='‚úì Copied!'; setTimeout(() => this.innerText='üìã Copy Token', 2000);" style="background-color: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600;">
                            üìã Copy Token
                        </button>
                    </div>

                    <!-- Details -->
                    <table style="width: 100%; margin: 20px 0; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 8px; color: #6c757d; font-size: 13px; width: 140px;">üì± Device:</td>
                            <td style="padding: 8px; font-weight: 600; font-size: 13px;"><t t-out="object.device_name or 'N/A'">Device</t></td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; color: #6c757d; font-size: 13px;">üåê Host:</td>
                            <td style="padding: 8px; font-weight: 600; font-size: 13px;"><t t-out="object.host_id.domain or ''">host.example.com</t></td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; color: #6c757d; font-size: 13px;">‚è∞ Expires:</td>
                            <td style="padding: 8px; font-weight: 600; font-size: 13px;"><t t-out="format_datetime(object.expires_at, dt_format='medium')">2025-01-01</t></td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; color: #6c757d; font-size: 13px;">üî¢ Max Uses:</td>
                            <td style="padding: 8px; font-weight: 600; font-size: 13px;"><t t-out="object.max_uses or 1">1</t></td>
                        </tr>
                    </table>

                    <!-- Instructions -->
                    <div style="background: #d1ecf1; border-left: 4px solid #0c5460; padding: 15px; margin: 20px 0; border-radius: 4px;">
                        <h3 style="margin: 0 0 10px; color: #0c5460; font-size: 16px;">üìã Setup Instructions</h3>
                        <ol style="margin: 0; padding-left: 20px; color: #0c5460; font-size: 13px; line-height: 1.8;">
                            <li>Copy the setup token above</li>
                            <li>Visit <a t-attf-href="https://{{object.host_id.domain}}" style="color: #0c5460; text-decoration: underline;"><t t-out="object.host_id.domain or ''">your-host.com</t></a></li>
                            <li>You will be redirected to the Sunray setup page</li>
                            <li>Enter your username (<strong><t t-out="object.user_id.username or ''">username</t></strong>) and the token</li>
                            <li>Follow the passkey registration process on your device</li>
                        </ol>
                    </div>

                    <!-- Security Notes -->
                    <div style="background: #fff3cd; border-left: 4px solid #856404; padding: 15px; margin: 20px 0; border-radius: 4px;">
                        <h3 style="margin: 0 0 10px; color: #856404; font-size: 16px;">üîí Security Notes</h3>
                        <ul style="margin: 0; padding-left: 20px; color: #856404; font-size: 13px; line-height: 1.8;">
                            <li>This token is valid for <strong><t t-out="object.max_uses or 1">1</t> use(s)</strong></li>
                            <li>Token expires in <strong><t t-out="(object.expires_at - datetime.datetime.now()).days">1</t> day(s)</strong></li>
                            <li>Only valid for <strong><t t-out="object.host_id.domain or ''">your-host.com</t></strong></li>
                            <t t-if="object.allowed_cidrs">
                                <li>IP restrictions apply</li>
                            </t>
                            <li>Do not share this token with anyone</li>
                        </ul>
                    </div>
                </td>
            </tr>

            <!-- Footer -->
            <tr>
                <td style="background: #f8f9fa; padding: 20px; text-align: center; border-radius: 0 0 8px 8px; border-top: 1px solid #e9ecef;">
                    <p style="margin: 0; color: #6c757d; font-size: 12px;">
                        This is an automated message from Sunray-Zero-Trust.
                    </p>
                    <p style="margin: 8px 0 0; color: #6c757d; font-size: 12px;">
                        If you did not request this token, please contact your administrator.
                    </p>
                </td>
            </tr>
        </table>
    </div>
</div>
            </field>
        </record>

        <!-- Email Template: Setup Token (Simple Text Version) -->
        <record id="mail_template_setup_token_simple_v2" model="mail.template">
            <field name="name">Sunray: Setup Token (Simple)</field>
            <field name="model_id" ref="sunray_core.model_sunray_setup_token"/>
            <field name="subject">Your Sunray Setup Token</field>
            <field name="email_from">{{ object.env.company.email_formatted or 'Sunray Zero Trust &lt;noreply@sunray-zero-trust.com&gt;' }}</field>
            <field name="email_to">{{ object.user_id.email }}</field>
            <field name="auto_delete" eval="False"/>
            <field name="body_html" type="html">
<div style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; padding: 20px;">
    <p>Hello <t t-out="object.user_id.username or ''">User</t>,</p>

    <p>Your Sunray setup token has been generated:</p>

    <div style="background: #f5f5f5; padding: 15px; margin: 15px 0; border-left: 4px solid #4a90e2; font-family: monospace; font-size: 16px; font-weight: bold;">
        <t t-out="ctx.get('token_value', '')">TOKEN-VALUE</t>
    </div>

    <p><strong>Details:</strong></p>
    <ul>
        <li>Username: <t t-out="object.user_id.username or ''">username</t></li>
        <li>Host: <t t-out="object.host_id.domain or ''">host.example.com</t></li>
        <li>Device: <t t-out="object.device_name or 'N/A'">Device</t></li>
        <li>Expires: <t t-out="format_datetime(object.expires_at, dt_format='medium')">2025-01-01</t></li>
        <li>Max Uses: <t t-out="object.max_uses or 1">1</t></li>
    </ul>

    <p><strong>Instructions:</strong></p>
    <ol>
        <li>Visit <t t-out="object.host_id.domain or ''">your-host.com</t></li>
        <li>Enter your username and the token above</li>
        <li>Complete the passkey registration</li>
    </ol>

    <p style="color: #666; font-size: 12px; margin-top: 30px;">
        This is an automated message. If you did not request this token, please contact your administrator.
    </p>
</div>
            </field>
        </record>
    </data>
</odoo>
