name = "sunray-worker"
main = "src/index.js"
compatibility_date = "2024-11-01"
workers_dev = true
account_id = "374806389059d0f432e88bae437bac53"  # oursbleu account - ONLY authorized account

# KV Namespaces for caching and session storage
[[kv_namespaces]]
binding = "CONFIG_CACHE"
id = "9d13d31c0e734c969e1ab57b58fe644c"
preview_id = "fb646bf577ba4cc2a2a829da6ac71360"

[[kv_namespaces]]
binding = "SESSIONS"
id = "72d472d5b72e405b81f15f823fe0c651"
preview_id = "de7d498963df4647aa6fef97197cd4a8"

[[kv_namespaces]]
binding = "CHALLENGES"
id = "952656e635fb49ee8bb01add3602e5ed"
preview_id = "85570b37da5d4e63a99ec07f2d173f7a"

[[kv_namespaces]]
binding = "CONTROL_SIGNALS"
id = "77dce3eabc1d4daa8ba73bdc3c263a36"
preview_id = "a12b6c925fb043f6a2e1184c6a4c6e75"

# Environment variables (will be set via wrangler secret)
[vars]
ADMIN_API_ENDPOINT = "https://sunray-server-dev-cyril.pack8s.com"
RP_ID = "odoo18-cfed-test-g.pack8s.com"  # The domain being protected
RP_NAME = "Sunray Authentication"
CACHE_TTL = "300"
SESSION_TTL = "86400"
CHALLENGE_TTL = "300"
WORKER_ID = "sunray-worker-001"
LOG_LEVEL = "error"  # Options: debug, info, warn, error, none

# Routes - Worker intercepts ALL requests to protected domain
# Pattern with leading asterisk (*) will also protect subdomain variations (e.g., admin-odoo18-cfed-test-g.pack8s.com)
# Without asterisk, only the exact domain is protected
routes = [
  { pattern = "*odoo18-cfed-test-g.pack8s.com/*", zone_name = "pack8s.com" }
]

# Secrets (set via wrangler secret put)
# ADMIN_API_KEY - API key for admin server
# SESSION_SECRET - Secret for signing session cookies

[observability]
enabled = true
# optional. default = 1.
head_sampling_rate = 1 